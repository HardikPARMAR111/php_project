<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Browse Books</title>
    <link href="../css/style.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h2>Browse Books</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Year</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="booksTable">
          <!-- Example rows, to be dynamically filled by PHP/MongoDB later -->
          <tr>
            <td>The Great Gatsby</td>
            <td>F. Scott Fitzgerald</td>
            <td>1925</td>
            <td>
              <a href="rent_book.html?book_id=1" class="btn btn-primary btn-sm"
                >Rent</a
              >
            </td>
          </tr>
          <tr>
            <td>1984</td>
            <td>George Orwell</td>
            <td>1949</td>
            <td>
              <a href="rent_book.html?book_id=2" class="btn btn-primary btn-sm"
                >Rent</a
              >
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <script>
      async function loadBooks() {
        const tableBody = document.getElementById("booksTable");
        tableBody.innerHTML = "<tr><td colspan='4'>Loading...</td></tr>";
      
        try {
          const response = await fetch("http://localhost/php_project/backend/index.php?action=getBooks");
          const result = await response.json();
      
          if (!result.success) {
            tableBody.innerHTML = "<tr><td colspan='4'>Failed to fetch books</td></tr>";
            return;
          }
      
          const books = result.data;
      
          tableBody.innerHTML = ""; // clear old data
      
          books.forEach(book => {
            const row = `
              <tr>
                <td>${book.title}</td>
                <td>${book.author}</td>
                <td>${book.year}</td>
                <td>
                  <a href="rent_book.html?book_id=${book.id}" class="btn btn-primary btn-sm">Rent</a>
                </td>
              </tr>
            `;
            tableBody.innerHTML += row;
          });
        } catch (err) {
          console.error(err);
          tableBody.innerHTML = "<tr><td colspan='4'>Error loading books</td></tr>";
        }
      }
      
      loadBooks();
      </script>
      
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
